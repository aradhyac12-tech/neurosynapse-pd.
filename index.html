<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NeuroSynapse-PD | Clinical AI System v11.0</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>

<!-- SIDEBAR -->
<div class="sidebar" id="sidebar">
    <div class="sidebar-header">
        <h2>üß† NeuroSynapse</h2>
        <p>v11.0 Clinical Edition</p>
    </div>
    
    <div class="menu-item" onclick="closeSidebar(); nav('v-dash');">
        <i class="fas fa-home"></i> Dashboard
    </div>
    <div class="menu-item" onclick="closeSidebar(); nav('v-tremor');">
        <i class="fas fa-hand-holding"></i> Tremor
    </div>
    <div class="menu-item" onclick="closeSidebar(); nav('v-tap');">
        <i class="fas fa-hand-pointer"></i> Tapping
    </div>
    <div class="menu-item" onclick="closeSidebar(); nav('v-voice');">
        <i class="fas fa-microphone"></i> Voice
    </div>
    <div class="menu-item" onclick="closeSidebar(); nav('v-gait');">
        <i class="fas fa-person-walking"></i> Gait
    </div>
    <div class="menu-item" onclick="closeSidebar(); nav('v-spiral');">
        <i class="fas fa-pen-nib"></i> Spiral
    </div>
    <div class="menu-item" onclick="closeSidebar(); nav('v-face');">
        <i class="fas fa-face-smile"></i> Facial
    </div>
    <div class="menu-item" onclick="closeSidebar(); nav('v-report');">
        <i class="fas fa-chart-radar"></i> Report
    </div>

    <div class="sidebar-section">
        <h3>‚öôÔ∏è SETTINGS</h3>
        <div class="stab-toggle">
            <label>Anti-Tremor</label>
            <input type="checkbox" id="stabSwitch" onchange="toggleStabilizer()" style="width:20px; height:20px; cursor:pointer;">
        </div>
        <div id="stabBadge" class="stab-badge">‚óè Active</div>

        <h3 style="margin-top: 20px;">‚ÑπÔ∏è ABOUT PD</h3>
        <div class="parkinsons-info">
            <strong>Parkinson's Disease</strong> is a neurodegenerative disorder. Digital biomarkers enable early detection and tracking.
        </div>

        <div class="contact-box">
            <strong>üß† Aradhya Chavan</strong><br>
            <a href="mailto:aradhyachavan2@gmail.com">‚úâÔ∏è Email</a><br>
            <a href="https://wa.me/919665151205">üì± WhatsApp</a>
        </div>
    </div>
</div>

<!-- NAVBAR -->
<div class="navbar">
    <div class="hamburger" id="hamburger">
        <i class="fas fa-bars"></i>
    </div>
    <div class="navbar-title">NeuroSynapse-PD</div>
    <div class="progress-info" id="progressBar">0%</div>
</div>

<!-- MAIN CONTAINER -->
<div id="app-container">

    <!-- SPLASH SCREEN -->
    <div id="v-splash" class="view active">
        <div class="splash-brain">üß†</div>
        <h1>NeuroSynapse-PD</h1>
        <p>Clinical AI Phenotyping System v11.0</p>
        
        <div class="card" style="margin-top: 40px; border: 2px solid var(--neon); background: rgba(0,217,255,0.05); max-width: 300px;">
            <div style="font-size: 9px; text-transform: uppercase; color: var(--neon);">Created by</div>
            <h2 style="margin: 5px 0 0 0; font-size: 18px;">Aradhya Chavan</h2>
            <div style="font-size: 11px; color: var(--muted); margin-top: 5px;">FDA-Aligned Research Prototype</div>
        </div>

        <button class="btn" style="max-width: 250px; margin-top: 30px;" id="initBtn" onclick="startApp()">
            <i class="fas fa-play-circle"></i> Initialize System
        </button>
    </div>

    <!-- PATIENT INTAKE -->
    <div id="v-intake" class="view">
        <h2>Patient Profile</h2>
        <p class="subtitle">Mandatory Demographics</p>

        <div class="card">
            <input id="pName" type="text" placeholder="Full Name *" required>
            <input id="pAge" type="number" placeholder="Age *" min="18" max="120" required>
            <select id="pGender" required>
                <option value="">Select Gender *</option>
                <option value="Male">Male</option>
                <option value="Female">Female</option>
                <option value="Other">Other</option>
            </select>
            <input id="pContact" type="text" placeholder="Phone/Email *" required>
        </div>

        <button class="btn" id="startBtn" onclick="initDash()">
            <i class="fas fa-arrow-right"></i> Start Assessment
        </button>
    </div>

    <!-- DASHBOARD -->
    <div id="v-dash" class="view">
        <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
            <div>
                <h2 id="pName-display" style="margin: 0;">Patient</h2>
                <p class="subtitle" style="margin: 0;">Age: <span id="pAge-display">--</span> | <span id="pGender-display">--</span></p>
            </div>
            <div style="font-size: 28px;">üß†</div>
        </div>

        <div class="card" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; text-align: center;">
            <div>
                <div class="subtitle">Progress</div>
                <div id="progTxt" style="font-size: 24px; font-weight: 900; color: var(--success);">0/7</div>
            </div>
            <div>
                <div class="subtitle">PD Risk</div>
                <div id="riskTxt" style="font-size: 24px; font-weight: 900; color: var(--danger);">--</div>
            </div>
        </div>

        <h3 style="text-transform: uppercase; color: var(--muted); font-size: 11px; margin: 20px 0 15px 0;">FDA Screening Modules</h3>

        <button class="btn btn-secondary" onclick="nav('v-tremor')" style="justify-content: flex-start; gap: 15px;">
            <i class="fas fa-hand-holding" style="color: var(--neon); font-size: 16px;"></i>
            <div style="text-align: left;">
                <div style="font-weight: 700; font-size: 13px;">1. Resting Tremor</div>
                <div style="font-size: 10px; color: var(--muted);">Accelerometer + Gyroscope</div>
            </div>
        </button>

        <button class="btn btn-secondary" onclick="nav('v-tap')" style="justify-content: flex-start; gap: 15px;">
            <i class="fas fa-hand-pointer" style="color: var(--accent); font-size: 16px;"></i>
            <div style="text-align: left;">
                <div style="font-weight: 700; font-size: 13px;">2. Bradykinesia</div>
                <div style="font-size: 10px; color: var(--muted);">Finger Tapping Speed</div>
            </div>
        </button>

        <button class="btn btn-secondary" onclick="nav('v-voice')" style="justify-content: flex-start; gap: 15px;">
            <i class="fas fa-microphone" style="color: var(--success); font-size: 16px;"></i>
            <div style="text-align: left;">
                <div style="font-weight: 700; font-size: 13px;">3. Phonation</div>
                <div style="font-size: 10px; color: var(--muted);">Voice Jitter & Shimmer</div>
            </div>
        </button>

        <button class="btn btn-secondary" onclick="nav('v-gait')" style="justify-content: flex-start; gap: 15px;">
            <i class="fas fa-person-walking" style="color: var(--neon); font-size: 16px;"></i>
            <div style="text-align: left;">
                <div style="font-weight: 700; font-size: 13px;">4. Gait & Balance</div>
                <div style="font-size: 10px; color: var(--muted);">Step Variability Analysis</div>
            </div>
        </button>

        <button class="btn btn-secondary" onclick="nav('v-spiral')" style="justify-content: flex-start; gap: 15px;">
            <i class="fas fa-pen-nib" style="color: var(--danger); font-size: 16px;"></i>
            <div style="text-align: left;">
                <div style="font-weight: 700; font-size: 13px;">5. Spiral Drawing</div>
                <div style="font-size: 10px; color: var(--muted);">Micrographia Detection</div>
            </div>
        </button>

        <button class="btn btn-secondary" onclick="nav('v-face')" style="justify-content: flex-start; gap: 15px;">
            <i class="fas fa-face-smile" style="color: #fbbf24; font-size: 16px;"></i>
            <div style="text-align: left;">
                <div style="font-weight: 700; font-size: 13px;">6. Facial Expression</div>
                <div style="font-size: 10px; color: var(--muted);">Hypomimia Detection</div>
            </div>
        </button>

        <button class="btn" style="margin-top: 20px;" onclick="nav('v-report')">
            <i class="fas fa-chart-radar"></i> Generate Report
        </button>
    </div>

    <!-- TREMOR MODULE -->
    <div id="v-tremor" class="view">
        <h2>Resting Tremor Analysis</h2>
        <p class="subtitle">Accelerometer + Gyroscope (10s)</p>

        <div class="card">
            <canvas id="tremorCanvas"></canvas>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 12px;">
                <div>
                    <div class="subtitle" style="margin: 0;">Frequency</div>
                    <div id="tFreq" style="font-size: 20px; font-weight: 900; color: var(--neon);">0 Hz</div>
                </div>
                <div>
                    <div class="subtitle" style="margin: 0;">Amplitude</div>
                    <div id="tAmp" style="font-size: 20px; font-weight: 900; color: var(--neon);">0 m/s¬≤</div>
                </div>
            </div>
        </div>

        <button class="btn" id="btn-tremor" onclick="startTremorTest()">
            <i class="fas fa-play"></i> Start Test (10s)
        </button>
        <button class="btn btn-secondary" onclick="nav('v-dash')">
            <i class="fas fa-arrow-left"></i> Back
        </button>
    </div>

    <!-- BRADYKINESIA (TAPPING) MODULE -->
    <div id="v-tap" class="view">
        <h2>Bradykinesia Detection</h2>
        <p class="subtitle">Finger Tapping Speed (10s)</p>

        <div class="card">
            <button id="tapZone" class="tap-zone">
                TAP RAPIDLY HERE
            </button>
            <div style="text-align: center; margin-top: 15px;">
                <div id="tapCount" style="font-size: 32px; font-weight: 900; color: var(--neon);">0</div>
                <div class="subtitle" style="margin: 0;">Taps per 10 seconds</div>
                <p style="font-size: 11px; color: var(--muted); margin: 5px 0 0 0;">Normal: >30 | Slow: <30</p>
            </div>
        </div>

        <button class="btn" id="btn-tap" onclick="startTapTest()">
            <i class="fas fa-play"></i> Start Timer (10s)
        </button>
        <button class="btn btn-secondary" onclick="nav('v-dash')">
            <i class="fas fa-arrow-left"></i> Back
        </button>
    </div>

    <!-- VOICE MODULE -->
    <div id="v-voice" class="view">
        <h2>Phonation Analysis</h2>
        <p class="subtitle">Voice Jitter, Shimmer & Pitch (5s)</p>

        <div class="card">
            <canvas id="voiceCanvas"></canvas>
            <div style="text-align: center; font-size: 11px; color: var(--muted); margin-top: 8px;">
                Real-time Frequency Spectrum (Hz)
            </div>
        </div>

        <div class="card" style="background: rgba(0,217,255,0.05); border: 1px solid var(--neon);">
            <p style="margin: 0; font-size: 12px; color: var(--text); line-height: 1.6;">
                üìù <strong>Instructions:</strong><br>
                1. Find a quiet place<br>
                2. Click "Start Recording"<br>
                3. Say "AAHHHHH" steadily for 5 seconds<br>
                4. Keep the same pitch throughout
            </p>
        </div>

        <button class="btn" id="btn-voice" onclick="startVoiceTest()">
            <i class="fas fa-microphone"></i> Start Recording (5s)
        </button>
        <button class="btn btn-secondary" onclick="nav('v-dash')">
            <i class="fas fa-arrow-left"></i> Back
        </button>
    </div>

    <!-- GAIT MODULE -->
    <div id="v-gait" class="view">
        <h2>Gait & Balance Analysis</h2>
        <p class="subtitle">Accelerometer + Gyroscope (20s Walk)</p>

        <div class="card">
            <p style="font-size: 12px; line-height: 1.7; margin: 0; color: var(--text);">
                <strong>Setup Instructions:</strong><br>
                ‚úì Hold phone in dominant hand at waist level<br>
                ‚úì Walk 10 feet away in a straight line<br>
                ‚úì Turn and walk back slowly<br>
                ‚úì We measure step variability & stability
            </p>
        </div>

        <div class="card">
            <canvas id="gaitCanvas"></canvas>
        </div>

        <button class="btn" id="btn-gait" onclick="startGaitTest()">
            <i class="fas fa-person-walking"></i> Start Walking (20s)
        </button>
        <button class="btn btn-secondary" onclick="nav('v-dash')">
            <i class="fas fa-arrow-left"></i> Back
        </button>
    </div>

    <!-- SPIRAL TEST MODULE -->
    <div id="v-spiral" class="view">
        <h2>Spiral Drawing Test</h2>
        <p class="subtitle">Micrographia & Tremor Detection</p>

        <div class="card">
            <p style="font-size: 11px; color: var(--muted); margin: 0 0 10px 0;">Draw a spiral from inside to outside</p>
            <canvas id="spiralCanvas" class="spiral-canvas"></canvas>
        </div>

        <button class="btn" id="btn-spiral-clear" onclick="clearSpiral()">
            <i class="fas fa-eraser"></i> Clear & Retry
        </button>
        <button class="btn" id="btn-spiral-done" onclick="analyzeSpiral()">
            <i class="fas fa-check-circle"></i> Done Drawing
        </button>
        <button class="btn btn-secondary" onclick="nav('v-dash')">
            <i class="fas fa-arrow-left"></i> Back
        </button>
    </div>

    <!-- FACIAL EXPRESSION MODULE -->
    <div id="v-face" class="view">
        <h2>Facial Expression</h2>
        <p class="subtitle">Hypomimia Detection (Front Camera)</p>

        <div class="card" id="faceCardOuter">
            <video id="faceVideo" autoplay playsinline muted style="width: 100%; border-radius: 10px; display: none; background: #000;"></video>
            <canvas id="faceCanvas" style="width: 100%; border-radius: 10px; background: #000;"></canvas>
        </div>

        <button class="btn" id="btn-face-start" onclick="startFaceTest()">
            <i class="fas fa-camera"></i> Start Camera (10s)
        </button>
        <button class="btn btn-secondary" onclick="nav('v-dash')">
            <i class="fas fa-arrow-left"></i> Back
        </button>
    </div>

    <!-- REPORT -->
    <div id="v-report" class="view">
        <h2>Clinical Assessment Report</h2>
        <p class="subtitle">Risk Analysis & Summary</p>

        <!-- Patient Info Card -->
        <div class="card" style="border: 2px solid var(--neon); background: rgba(0,217,255,0.05); text-align: center;">
            <div style="font-size: 9px; text-transform: uppercase; color: var(--neon); margin-bottom: 8px;">Patient Information</div>
            <h3 style="margin: 0; font-size: 16px;">
                <span id="rep-name">--</span>
            </h3>
            <div style="font-size: 11px; color: var(--muted); margin-top: 8px;">
                <span id="rep-age">--</span> years old | <span id="rep-gender">--</span><br>
                Contact: <span id="rep-contact">--</span>
            </div>
        </div>

        <!-- Clinician Card -->
        <div class="card" style="border: 2px solid var(--neon); background: rgba(0,217,255,0.05); text-align: center;">
            <div style="font-size: 9px; text-transform: uppercase; color: var(--neon); margin-bottom: 8px;">Clinician</div>
            <h3 style="margin: 0; font-size: 16px;">Aradhya Chavan</h3>
            <div style="font-size: 11px; color: var(--muted); margin-top: 8px;">
                <a href="https://wa.me/919665151205" style="color: var(--neon); text-decoration: none; font-weight: 700;">üì± +91 96651 51205</a><br>
                <a href="mailto:aradhyachavan2@gmail.com" style="color: var(--neon); text-decoration: none; font-weight: 700;">‚úâÔ∏è aradhyachavan2@gmail.com</a>
            </div>
        </div>

        <!-- Risk Radar Chart -->
        <div class="card">
            <canvas id="radarChart" style="height: 280px;"></canvas>
        </div>

        <!-- Results Table -->
        <div class="card">
            <h3 style="margin-top: 0; font-size: 16px;">Test Results</h3>
            <table class="results-table">
                <tr>
                    <td><strong>Tremor Amplitude</strong></td>
                    <td id="rep-tremor" style="text-align: right; color: var(--neon);">-- m/s¬≤</td>
                </tr>
                <tr style="background: rgba(0,217,255,0.03);">
                    <td><strong>Tremor Frequency</strong></td>
                    <td id="rep-tfreq" style="text-align: right; color: var(--neon);">-- Hz</td>
                </tr>
                <tr>
                    <td><strong>Tapping Speed</strong></td>
                    <td id="rep-tap" style="text-align: right; color: var(--neon);">-- taps/10s</td>
                </tr>
                <tr style="background: rgba(0,217,255,0.03);">
                    <td><strong>Voice Jitter</strong></td>
                    <td id="rep-jitter" style="text-align: right; color: var(--neon);">-- %</td>
                </tr>
                <tr>
                    <td><strong>Gait Variability</strong></td>
                    <td id="rep-gait" style="text-align: right; color: var(--neon);">-- %</td>
                </tr>
                <tr style="background: rgba(0,217,255,0.03);">
                    <td><strong>Spiral Smoothness</strong></td>
                    <td id="rep-spiral" style="text-align: right; color: var(--neon);">-- %</td>
                </tr>
                <tr style="background: rgba(16, 185, 129, 0.1);">
                    <td><strong>Overall PD Risk</strong></td>
                    <td id="rep-risk" style="text-align: right; font-weight: 900; color: var(--danger); font-size: 16px;">-- %</td>
                </tr>
            </table>
        </div>

        <!-- Findings -->
        <div class="card">
            <h3 style="margin-top: 0;">Clinical Findings</h3>
            <div id="rep-findings" style="font-size: 12px; line-height: 1.7;">
                Waiting for assessment completion...
            </div>
        </div>

        <!-- Feedback -->
        <div class="card" style="background: rgba(255,71,87,0.05); border: 1px solid var(--danger);">
            <div style="font-size: 9px; text-transform: uppercase; color: var(--danger); margin-bottom: 10px;">Validation</div>
            <div style="display: flex; gap: 8px;">
                <button class="btn btn-secondary" style="flex: 1; margin: 0;" onclick="flagValid()">
                    <i class="fas fa-check-circle"></i> Accurate
                </button>
                <button class="btn btn-danger" style="flex: 1; margin: 0;" onclick="flagError()">
                    <i class="fas fa-exclamation"></i> Flag Error
                </button>
            </div>
            <div id="feedbackMsg" style="font-size: 10px; text-align: center; margin-top: 8px; color: var(--success); display: none;">
                ‚úì Feedback Logged
            </div>
        </div>

        <button class="btn" onclick="generatePDF()">
            <i class="fas fa-file-pdf"></i> Download PDF Report
        </button>

        <button class="btn btn-secondary" onclick="nav('v-dash')">
            <i class="fas fa-arrow-left"></i> Back to Dashboard
        </button>
    </div>

</div>

<!-- FALL ALERT MODAL -->
<div id="fallAlert" class="modal">
    <div class="modal-content">
        <h2 style="color: var(--danger); margin-top: 0;">üö® Possible Fall Detected</h2>
        <p style="margin: 10px 0 20px 0;">Are you okay?</p>
        <button class="btn" onclick="dismissFallAlert()" style="margin-bottom: 10px;">
            <i class="fas fa-check-circle"></i> I'm OK
        </button>
        <button class="btn btn-danger" onclick="callHelp()">
            <i class="fas fa-phone"></i> Call for Help
        </button>
    </div>
</div>

<script src="app.js"></script>

</body>
</html>