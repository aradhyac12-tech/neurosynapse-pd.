<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeuroCompass-PD | MDS-UPDRS Assessment</title>
    <link rel="stylesheet" href="style.css">
    <!-- MediaPipe Pose v0.4.1633559619 PINNED VERSION -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose@0.4.1633559619/pose.js"></script>
    <!-- MediaPipe Face Detection v0.4.1633559619 PINNED VERSION -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_detection@0.4.1633559619/face_detection.js"></script>
    <!-- MediaPipe Face Mesh v0.4.1633559619 PINNED VERSION -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh@0.4.1633559619/face_mesh.js"></script>
    <!-- Drawing Utils v0.4.1633559619 PINNED VERSION -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils@0.4.1633559619/drawing_utils.js"></script>
    <!-- html2pdf for report export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body>
    <!-- SPLASH SCREEN -->
    <div id="splashScreen" class="splash-screen">
        <div class="splash-content">
            <h1>NeuroCompass-PD</h1>
            <p id="splashSub">MDS-UPDRS Clinical Assessment Suite</p>
            <div class="splash-spinner"></div>
        </div>
    </div>

    <!-- HEADER -->
    <header class="header">
        <button id="hamburgerBtn" class="hamburger-btn">‚ò∞</button>
        <div class="header-center">
            <h1>NeuroCompass-PD</h1>
        </div>
        <div class="header-controls">
            <select id="languageSelector" class="language-selector">
                <option value="en">English</option>
                <option value="hi">‡§π‡§ø‡§Ç‡§¶‡•Ä</option>
                <option value="ru">–†—É—Å—Å–∫–∏–π</option>
            </select>
            <button id="voiceBtn" class="voice-btn" title="Toggle Voice Assistant">üîä</button>
        </div>
    </header>

    <!-- SIDEBAR -->
    <aside id="sidebar" class="sidebar">
        <div class="sidebar-header">
            <h2 id="navTitle">Navigation</h2>
            <button id="closeSidebarBtn" class="close-btn">‚úï</button>
        </div>
        <nav class="sidebar-nav">
            <a href="#" class="nav-link active" data-view="dashboard" id="nav-dashboard">üìä Dashboard</a>
            <a href="#" class="nav-link" data-view="info" id="nav-info">‚ÑπÔ∏è PD Information</a>
            <a href="#" class="nav-link" data-view="patient" id="nav-patient">üë§ Patient Profile</a>
            <a href="#" class="nav-link" data-view="voice" id="nav-voice">üé§ Speech Assessment</a>
            <a href="#" class="nav-link" data-view="tremor" id="nav-tremor">üìà Tremor Assessment</a>
            <a href="#" class="nav-link" data-view="gait" id="nav-gait">üö∂ Gait Assessment</a>
            <a href="#" class="nav-link" data-view="facial" id="nav-facial">üòä Facial Expression</a>
            <a href="#" class="nav-link" data-view="questions" id="nav-questions">‚ùì Questions</a>
            <a href="#" class="nav-link" data-view="spiral" id="nav-spiral">üåÄ Spiral Drawing</a>
            <a href="#" class="nav-link" data-view="results" id="nav-results">üìã Results</a>
            <a href="#" class="nav-link" data-view="report" id="nav-report">üìÑ Report</a>
        </nav>
        <div class="sidebar-footer">
            <p>NeuroCompass-PD v4.4.1</p>
            <p style="font-size: 11px; color: var(--color-text-secondary);">Clinical Ready</p>
        </div>
    </aside>

    <!-- SIDEBAR OVERLAY -->
    <div id="sidebarOverlay" class="sidebar-overlay"></div>

    <!-- MAIN CONTENT -->
    <main class="main-content">

        <!-- DASHBOARD VIEW -->
        <div id="dashboardView" class="view active">
            <div class="card">
                <h2 id="dash-title">Clinical Assessment Dashboard</h2>
                <p id="dash-subtitle" style="color: var(--color-text-secondary); margin-bottom: 24px;">MDS-UPDRS Part III digital screening summary</p>
                
                <div class="dashboard-grid">
                    <div class="dashboard-box">
                        <div class="box-icon">üë§</div>
                        <h3 id="dash-patient">Patient Profile</h3>
                        <p id="patientStatus" style="color: var(--color-text-secondary); font-size: 12px;">Not started</p>
                    </div>
                    <div class="dashboard-box">
                        <div class="box-icon">üß™</div>
                        <h3 id="dash-tests">Screening Tests</h3>
                        <p id="testCount" style="color: var(--color-text-secondary); font-size: 12px;">0/6 completed</p>
                    </div>
                    <div class="dashboard-box">
                        <div class="box-icon">üìä</div>
                        <h3 id="dash-report">Results</h3>
                        <p id="reportStatus" style="color: var(--color-text-secondary); font-size: 12px;">Awaiting tests</p>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>Assessment Hub</h2>
                <p style="color: var(--color-text-secondary); margin-bottom: 24px;">Open any screening test below. Tests unlock after Patient Profile is saved.</p>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 16px;">
                    <button class="btn btn-primary" style="cursor: pointer;" onclick="navigateTo('voice')">üé§ Speech</button>
                    <button class="btn btn-primary" style="cursor: pointer;" onclick="navigateTo('tremor')">üìà Tremor</button>
                    <button class="btn btn-primary" style="cursor: pointer;" onclick="navigateTo('gait')">üö∂ Gait</button>
                    <button class="btn btn-primary" style="cursor: pointer;" onclick="navigateTo('facial')">üòä Facial</button>
                    <button class="btn btn-primary" style="cursor: pointer;" onclick="navigateTo('questions')">‚ùì Questions</button>
                    <button class="btn btn-primary" style="cursor: pointer;" onclick="navigateTo('spiral')">üåÄ Spiral</button>
                </div>
            </div>
        </div>

        <!-- INFO VIEW -->
        <div id="infoView" class="view">
            <div class="card">
                <h2 id="info-title">Parkinson's Disease Information</h2>
                <p id="info-subtitle" style="color: var(--color-text-secondary); margin-bottom: 24px;">Clinical background and MDS-UPDRS Part III protocol</p>
                
                <h3 id="info-what">What is Parkinson's?</h3>
                <p id="info-desc">Progressive neurodegenerative disorder with tremor, bradykinesia, rigidity and postural instability.</p>
                
                <h3 id="info-updrs-title">MDS-UPDRS Part III</h3>
                <p id="info-updrs-desc">Motor examination with 18 items scored 0-4 (0 = normal, 4 = severe).</p>
                
                <h3 id="info-biomarker-title">Digital Biomarkers</h3>
                <p id="info-biomarker-desc">Speech, tremor, gait and facial metrics captured as objective digital signatures.</p>
                
                <p style="color: var(--color-text-secondary); font-size: 12px; margin-top: 24px; padding-top: 16px; border-top: 1px solid var(--color-border);" id="info-note">This is a research prototype. Interpret with clinician oversight.</p>
                
                <button class="btn btn-primary" onclick="navigateTo('patient')" style="margin-top: 24px;">Proceed to Patient Profile ‚Üí</button>
            </div>
        </div>

        <!-- PATIENT VIEW -->
        <div id="patientView" class="view">
            <div class="card">
                <h2 id="form-title">Patient Demographic & Contact Information</h2>
                <p id="form-subtitle" style="color: var(--color-text-secondary); margin-bottom: 24px;">Required for documentation before screening</p>
                
                <form onsubmit="savePatient(event)">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 24px;">
                        <div>
                            <label id="label-first" class="form-label">First Name</label>
                            <input type="text" id="firstName" class="form-input" required>
                        </div>
                        <div>
                            <label id="label-last" class="form-label">Last Name</label>
                            <input type="text" id="lastName" class="form-input" required>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 24px;">
                        <label id="label-dob" class="form-label">Date of Birth</label>
                        <input type="date" id="dob" class="form-input" required onchange="validateAge()">
                        <p id="ageError" style="color: var(--color-error); font-size: 12px; display: none;">‚ö†Ô∏è Patient must be 18 or older</p>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 24px;">
                        <div>
                            <label id="label-gender" class="form-label">Gender</label>
                            <select id="gender" class="form-input" required>
                                <option value="">Select Gender</option>
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                                <option value="other">Other</option>
                                <option value="na">Prefer not to say</option>
                            </select>
                        </div>
                        <div>
                            <label id="label-country" class="form-label">Country Code</label>
                            <input type="text" id="countryCode" class="form-input" placeholder="e.g., +1" required>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 24px;">
                        <div>
                            <label id="label-phone" class="form-label">Phone Number</label>
                            <input type="tel" id="phone" class="form-input" placeholder="10 digits only" required>
                        </div>
                        <div>
                            <label id="label-email" class="form-label">Email Address</label>
                            <input type="email" id="email" class="form-input" required>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 24px;">
                        <label id="label-medid" class="form-label">Medical Record Number</label>
                        <input type="text" id="medicalId" class="form-input">
                    </div>
                    
                    <p style="color: var(--color-text-secondary); font-size: 12px; margin-bottom: 24px;" id="patient-note">All required fields must be valid before screening tests unlock.</p>
                    
                    <button type="submit" class="btn btn-primary">‚úì Save & Unlock Screening</button>
                </form>
            </div>
        </div>

        <!-- VOICE VIEW -->
        <div id="voiceView" class="view">
            <div class="card">
                <h2 id="voice-title">Speech Assessment</h2>
                <p id="voice-desc" style="color: var(--color-text-secondary); margin-bottom: 24px;">Record 3 trials of sustained vowel "AAAAA" (6 seconds each)</p>
                
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 24px;">
                    <div id="trial1" class="trial-badge">Trial 1</div>
                    <div id="trial2" class="trial-badge">Trial 2</div>
                    <div id="trial3" class="trial-badge">Trial 3</div>
                </div>
                
                <div id="voiceCountdown" style="display: none; text-align: center; margin-bottom: 24px;">
                    <p id="voice-countdown-text" style="color: var(--color-text-secondary);">Starting in...</p>
                    <div style="font-size: 48px; font-weight: bold; color: var(--color-primary);" id="voiceCountdownNum">3</div>
                </div>
                
                <div id="voiceWaveform" style="display: none; margin-bottom: 24px;">
                    <canvas id="voiceCanvas" width="600" height="150" style="width: 100%; max-width: 600px; border: 1px solid var(--color-border); border-radius: 8px;"></canvas>
                    <div style="text-align: center; margin-top: 16px;">
                        <p style="color: var(--color-primary); font-size: 24px; font-weight: bold;" id="voiceRecordingNum">6</p>
                    </div>
                </div>
                
                <div id="voiceMetrics" style="display: none; margin-bottom: 24px;">
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">
                        <div style="background: var(--color-bg-1); padding: 16px; border-radius: 8px;">
                            <p style="color: var(--color-text-secondary); font-size: 12px;" id="metric-jitter">Jitter (%)</p>
                            <p style="font-size: 20px; font-weight: bold; color: var(--color-primary);" id="jitterVal">0.0%</p>
                        </div>
                        <div style="background: var(--color-bg-2); padding: 16px; border-radius: 8px;">
                            <p style="color: var(--color-text-secondary); font-size: 12px;" id="metric-shimmer">Shimmer (dB)</p>
                            <p style="font-size: 20px; font-weight: bold; color: var(--color-primary);" id="shimmerVal">0.0 dB</p>
                        </div>
                        <div style="background: var(--color-bg-3); padding: 16px; border-radius: 8px;">
                            <p style="color: var(--color-text-secondary); font-size: 12px;" id="metric-hnr">HNR (dB)</p>
                            <p style="font-size: 20px; font-weight: bold; color: var(--color-primary);" id="hnrVal">0.0 dB</p>
                        </div>
                        <div style="background: var(--color-bg-4); padding: 16px; border-radius: 8px;">
                            <p style="color: var(--color-text-secondary); font-size: 12px;" id="metric-f0">Pitch (Hz)</p>
                            <p style="font-size: 20px; font-weight: bold; color: var(--color-primary);" id="f0Val">0 Hz</p>
                        </div>
                        <div style="background: var(--color-bg-5); padding: 16px; border-radius: 8px;">
                            <p style="color: var(--color-text-secondary); font-size: 12px;">UPDRS Score</p>
                            <p style="font-size: 20px; font-weight: bold; color: var(--color-primary);" id="voiceUpdrsVal">0/4</p>
                        </div>
                    </div>
                </div>
                
                <button id="voiceStartBtn" class="btn btn-primary" onclick="startVoiceRecording()" style="cursor: pointer;">üé§ Start Recording</button>
                <button id="voiceCompleteBtn" class="btn btn-primary" onclick="completeVoiceTest()" style="display: none; cursor: pointer;">‚úì Complete Speech Test</button>
            </div>
        </div>

        <!-- TREMOR VIEW -->
        <div id="tremorView" class="view">
            <div class="card">
                <h2 id="tremor-title">Tremor Assessment</h2>
                <p id="tremor-desc" style="color: var(--color-text-secondary); margin-bottom: 24px;">Hold device steady with one hand for 10 seconds</p>
                
                <div id="tremorHandSelect" style="display: flex; gap: 16px; margin-bottom: 24px; justify-content: center;">
                    <button class="btn btn-primary" onclick="selectTremorHand('left')" style="cursor: pointer;">üëà Left Hand</button>
                    <button class="btn btn-primary" onclick="selectTremorHand('right')" style="cursor: pointer;">üëâ Right Hand</button>
                </div>
                
                <div id="tremorCountdown" style="display: none; text-align: center; margin-bottom: 24px;">
                    <p id="tremor-countdown-text" style="color: var(--color-text-secondary);">Starting in...</p>
                    <div style="font-size: 48px; font-weight: bold; color: var(--color-primary);" id="tremorCountdownNum">3</div>
                </div>
                
                <div id="tremorWaveform" style="display: none; margin-bottom: 24px;">
                    <div style="text-align: center; margin-bottom: 12px;">
                        <div id="handEmoji" style="font-size: 48px;">üëâ</div>
                    </div>
                    <canvas id="tremorCanvas" width="600" height="150" style="width: 100%; max-width: 600px; border: 1px solid var(--color-border); border-radius: 8px;"></canvas>
                    <div style="text-align: center; margin-top: 16px;">
                        <p style="color: var(--color-primary); font-size: 24px; font-weight: bold;" id="tremorRecordingNum">10</p>
                    </div>
                </div>
                
                <div id="tremorMetrics" style="display: none; margin-bottom: 24px;">
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">
                        <div style="background: var(--color-bg-1); padding: 16px; border-radius: 8px;">
                            <p style="color: var(--color-text-secondary); font-size: 12px;" id="metric-freq">Frequency (Hz)</p>
                            <p style="font-size: 20px; font-weight: bold; color: var(--color-primary);" id="frequencyVal">0.0 Hz</p>
                        </div>
                        <div style="background: var(--color-bg-2); padding: 16px; border-radius: 8px;">
                            <p style="color: var(--color-text-secondary); font-size: 12px;" id="metric-amp">Amplitude (m/s¬≤)</p>
                            <p style="font-size: 20px; font-weight: bold; color: var(--color-primary);" id="amplitudeVal">0.0 m/s¬≤</p>
                        </div>
                        <div style="background: var(--color-bg-3); padding: 16px; border-radius: 8px;">
                            <p style="color: var(--color-text-secondary); font-size: 12px;" id="metric-pow">Power (dB)</p>
                            <p style="font-size: 20px; font-weight: bold; color: var(--color-primary);" id="powerVal">0.0 dB</p>
                        </div>
                        <div style="background: var(--color-bg-4); padding: 16px; border-radius: 8px;">
                            <p style="color: var(--color-text-secondary); font-size: 12px;">UPDRS Score</p>
                            <p style="font-size: 20px; font-weight: bold; color: var(--color-primary);" id="tremorUpdrsVal">0/4</p>
                        </div>
                    </div>
                </div>
                
                <button id="tremorStartBtn" class="btn btn-primary" style="display: none; cursor: pointer;" onclick="completeTremorTest()">‚úì Complete Tremor Test</button>
            </div>
        </div>

        <!-- GAIT VIEW -->
        <div id="gaitView" class="view">
            <div class="card">
                <h2 id="gait-title">Gait Assessment</h2>
                <p id="gait-desc" style="color: var(--color-text-secondary); margin-bottom: 24px;">Walk naturally while device captures motion</p>
                
                <div id="gaitCountdown" style="display: none; text-align: center; margin-bottom: 24px;">
                    <p id="gait-countdown-text" style="color: var(--color-text-secondary);">Starting in...</p>
                    <div style="font-size: 48px; font-weight: bold; color: var(--color-primary);" id="gaitCountdownNum">3</div>
                </div>
                
                <div id="gaitStabilizing" style="display: none; text-align: center; margin-bottom: 24px; padding: 32px; background: var(--color-secondary); border-radius: 8px;">
                    <p style="color: var(--color-text-secondary); font-size: 14px; margin-bottom: 12px;">Stabilizing camera feed...</p>
                    <div style="font-size: 28px; font-weight: bold; color: var(--color-primary);">üîÑ</div>
                </div>
                
                <div class="video-container" style="margin-bottom: 24px;">
                    <video id="gaitVideo" style="width: 100%; height: 100%; object-fit: contain; display: none;"></video>
                    <canvas id="gaitCanvas" style="width: 100%; height: 100%; object-fit: contain;"></canvas>
                </div>
                
                <div id="gaitMetrics" style="display: none; margin-bottom: 24px;">
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;">
                        <div style="background: var(--color-bg-1); padding: 16px; border-radius: 8px;">
                            <p style="color: var(--color-text-secondary); font-size: 12px;" id="metric-cad">Cadence (steps/min)</p>
                            <p style="font-size: 20px; font-weight: bold; color: var(--color-primary);" id="cadenceVal">0</p>
                        </div>
                        <div style="background: var(--color-bg-2); padding: 16px; border-radius: 8px;">
                            <p style="color: var(--color-text-secondary); font-size: 12px;" id="metric-str">Stride Length (m)</p>
                            <p style="font-size: 20px; font-weight: bold; color: var(--color-primary);" id="strideLengthVal">0.0 m</p>
                        </div>
                        <div style="background: var(--color-bg-3); padding: 16px; border-radius: 8px;">
                            <p style="color: var(--color-text-secondary); font-size: 12px;" id="metric-spd">Speed (m/s)</p>
                            <p style="font-size: 20px; font-weight: bold; color: var(--color-primary);" id="speedVal">0.0 m/s</p>
                        </div>
                    </div>
                </div>
                
                <button id="gaitStartBtn" class="btn btn-primary" onclick="startGaitTest()" style="cursor: pointer;">üö∂ Start Gait Test</button>
                <button id="gaitCompleteBtn" class="btn btn-primary" style="display: none; cursor: pointer;" onclick="completeGaitTest()">‚úì Complete Gait Test</button>
            </div>
        </div>

        <!-- FACIAL VIEW -->
        <div id="facialView" class="view">
            <div class="card">
                <h2 id="facial-title">Facial Expression Assessment</h2>
                <p id="facial-desc" style="color: var(--color-text-secondary); margin-bottom: 24px;">Maintain neutral expression while camera analyzes facial movement</p>
                
                <div id="facialCountdown" style="display: none; text-align: center; margin-bottom: 24px;">
                    <p id="facial-countdown-text" style="color: var(--color-text-secondary);">Starting in...</p>
                    <div style="font-size: 48px; font-weight: bold; color: var(--color-primary);" id="facialCountdownNum">3</div>
                </div>
                
                <div id="facialStabilizing" style="display: none; text-align: center; margin-bottom: 24px; padding: 32px; background: var(--color-secondary); border-radius: 8px;">
                    <p style="color: var(--color-text-secondary); font-size: 14px; margin-bottom: 12px;">Stabilizing camera feed...</p>
                    <div style="font-size: 28px; font-weight: bold; color: var(--color-primary);">üîÑ</div>
                </div>
                
                <div class="video-container" style="margin-bottom: 24px;">
                    <video id="facialVideo" style="width: 100%; height: 100%; object-fit: contain; display: none;"></video>
                    <canvas id="facialCanvas" style="width: 100%; height: 100%; object-fit: contain;"></canvas>
                </div>
                
                <div id="facialMetrics" style="display: none; margin-bottom: 24px;">
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;">
                        <div style="background: var(--color-bg-1); padding: 16px; border-radius: 8px;">
                            <p style="color: var(--color-text-secondary); font-size: 12px;" id="metric-blk">Blink Rate (/min)</p>
                            <p style="font-size: 20px; font-weight: bold; color: var(--color-primary);" id="blinkRateVal">0</p>
                        </div>
                        <div style="background: var(--color-bg-2); padding: 16px; border-radius: 8px;">
                            <p style="color: var(--color-text-secondary); font-size: 12px;" id="metric-jaw">Jaw Opening (cm)</p>
                            <p style="font-size: 20px; font-weight: bold; color: var(--color-primary);" id="jawOpeningVal">0.0 cm</p>
                        </div>
                        <div style="background: var(--color-bg-3); padding: 16px; border-radius: 8px;">
                            <p style="color: var(--color-text-secondary); font-size: 12px;" id="metric-mth">Mouth Width (cm)</p>
                            <p style="font-size: 20px; font-weight: bold; color: var(--color-primary);" id="mouthWidthVal">0.0 cm</p>
                        </div>
                    </div>
                </div>
                
                <button id="facialStartBtn" class="btn btn-primary" onclick="startFacialTest()" style="cursor: pointer;">üòä Start Facial Test</button>
                <button id="facialCompleteBtn" class="btn btn-primary" style="display: none; cursor: pointer;" onclick="completeFacialTest()">‚úì Complete Facial Test</button>
            </div>
        </div>

        <!-- QUESTIONS VIEW -->
        <div id="questionsView" class="view">
            <div class="card">
                <h2 id="questions-title">Question-Based Assessment</h2>
                <p id="questions-desc" style="color: var(--color-text-secondary); margin-bottom: 24px;">Answer a short set of clinical questions to support screening context</p>
                
                <form onsubmit="saveQuestions(event)">
                    <div style="margin-bottom: 24px;">
                        <label id="q1-label" style="display: block; margin-bottom: 12px; font-weight: 500;">1. Do you experience slowness of movement (bradykinesia)?</label>
                        <div style="display: flex; gap: 12px;">
                            <label style="display: flex; align-items: center;"><input type="radio" name="q1" value="0" required> No</label>
                            <label style="display: flex; align-items: center;"><input type="radio" name="q1" value="1" required> Sometimes</label>
                            <label style="display: flex; align-items: center;"><input type="radio" name="q1" value="2" required> Often</label>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 24px;">
                        <label id="q2-label" style="display: block; margin-bottom: 12px; font-weight: 500;">2. Do you have stiffness/rigidity in arms or legs?</label>
                        <div style="display: flex; gap: 12px;">
                            <label style="display: flex; align-items: center;"><input type="radio" name="q2" value="0" required> No</label>
                            <label style="display: flex; align-items: center;"><input type="radio" name="q2" value="1" required> Sometimes</label>
                            <label style="display: flex; align-items: center;"><input type="radio" name="q2" value="2" required> Often</label>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 24px;">
                        <label id="q3-label" style="display: block; margin-bottom: 12px; font-weight: 500;">3. Do you have balance issues or near falls?</label>
                        <div style="display: flex; gap: 12px;">
                            <label style="display: flex; align-items: center;"><input type="radio" name="q3" value="0" required> No</label>
                            <label style="display: flex; align-items: center;"><input type="radio" name="q3" value="1" required> Sometimes</label>
                            <label style="display: flex; align-items: center;"><input type="radio" name="q3" value="2" required> Often</label>
                        </div>
                    </div>
                    
                    <p style="color: var(--color-text-secondary); font-size: 12px; margin-bottom: 24px;" id="questions-note">This is a supportive questionnaire and not a diagnosis.</p>
                    
                    <button type="submit" class="btn btn-primary">‚úì Save Answers</button>
                </form>
            </div>
        </div>

        <!-- SPIRAL VIEW -->
        <div id="spiralView" class="view">
            <div class="card">
                <h2 id="spiral-title">Spiral Tremor Test</h2>
                <p id="spiral-desc" style="color: var(--color-text-secondary); margin-bottom: 24px;">Draw a spiral smoothly using your finger. Keep it as steady as possible.</p>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 24px;">
                    <div>
                        <p id="spiral-ref" style="color: var(--color-text-secondary); font-size: 12px; margin-bottom: 8px;">Reference Spiral</p>
                        <canvas id="referenceCanvas" width="300" height="300" style="border: 1px solid var(--color-border); border-radius: 8px; background: #f0f0f0;"></canvas>
                    </div>
                    <div>
                        <p id="spiral-your" style="color: var(--color-text-secondary); font-size: 12px; margin-bottom: 8px;">Your Drawing</p>
                        <canvas id="spiralCanvas" width="300" height="300" style="border: 1px solid var(--color-border); border-radius: 8px; background: #fff; cursor: crosshair; touch-action: none;"></canvas>
                    </div>
                </div>
                
                <div id="spiralMetrics" style="display: none; margin-bottom: 24px;">
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;">
                        <div style="background: var(--color-bg-1); padding: 16px; border-radius: 8px;">
                            <p style="color: var(--color-text-secondary); font-size: 12px;" id="metric-tridx">Tremor Index</p>
                            <p style="font-size: 20px; font-weight: bold; color: var(--color-primary);" id="tremorIndexVal">0.0</p>
                        </div>
                        <div style="background: var(--color-bg-2); padding: 16px; border-radius: 8px;">
                            <p style="color: var(--color-text-secondary); font-size: 12px;" id="metric-path">Path Length (px)</p>
                            <p style="font-size: 20px; font-weight: bold; color: var(--color-primary);" id="pathLengthVal">0</p>
                        </div>
                        <div style="background: var(--color-bg-3); padding: 16px; border-radius: 8px;">
                            <p style="color: var(--color-text-secondary); font-size: 12px;" id="metric-vel">Velocity (px/s)</p>
                            <p style="font-size: 20px; font-weight: bold; color: var(--color-primary);" id="velocityVal">0.0 px/s</p>
                        </div>
                    </div>
                </div>
                
                <div style="display: flex; gap: 12px; margin-bottom: 24px;">
                    <button class="btn btn-primary" onclick="clearSpiral()" style="cursor: pointer;">üîÑ Clear</button>
                    <button class="btn btn-primary" onclick="completeSpiralTest()" style="cursor: pointer;">‚úì Complete Spiral Test</button>
                </div>
                
                <p id="spiral-note" style="color: var(--color-text-secondary); font-size: 12px; margin-top: 24px; padding-top: 16px; border-top: 1px solid var(--color-border);">Spiral drawing is a common motor task used to observe tremor and control.</p>
            </div>
        </div>

        <!-- RESULTS VIEW -->
        <div id="resultsView" class="view">
            <div class="card">
                <h2 id="results-title">Assessment Results</h2>
                <table style="width: 100%; border-collapse: collapse; margin-bottom: 24px;">
                    <thead>
                        <tr style="border-bottom: 2px solid var(--color-border);">
                            <th style="text-align: left; padding: 12px; color: var(--color-text-secondary);">Domain</th>
                            <th style="text-align: left; padding: 12px; color: var(--color-text-secondary);">Status</th>
                            <th style="text-align: left; padding: 12px; color: var(--color-text-secondary);">Score</th>
                            <th style="text-align: left; padding: 12px; color: var(--color-text-secondary);">Severity</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="border-bottom: 1px solid var(--color-border);">
                            <td style="padding: 12px;">üé§ Speech</td>
                            <td style="padding: 12px;" id="rptVoiceStatus">-</td>
                            <td style="padding: 12px; font-weight: bold;" id="rptVoiceScore">-</td>
                            <td style="padding: 12px;" id="rptVoiceSev">-</td>
                        </tr>
                        <tr style="border-bottom: 1px solid var(--color-border);">
                            <td style="padding: 12px;">üìà Tremor</td>
                            <td style="padding: 12px;" id="rptTremorStatus">-</td>
                            <td style="padding: 12px; font-weight: bold;" id="rptTremorScore">-</td>
                            <td style="padding: 12px;" id="rptTremorSev">-</td>
                        </tr>
                        <tr style="border-bottom: 1px solid var(--color-border);">
                            <td style="padding: 12px;">üö∂ Gait</td>
                            <td style="padding: 12px;" id="rptGaitStatus">-</td>
                            <td style="padding: 12px; font-weight: bold;" id="rptGaitScore">-</td>
                            <td style="padding: 12px;" id="rptGaitSev">-</td>
                        </tr>
                        <tr style="border-bottom: 1px solid var(--color-border);">
                            <td style="padding: 12px;">üòä Facial</td>
                            <td style="padding: 12px;" id="rptFacialStatus">-</td>
                            <td style="padding: 12px; font-weight: bold;" id="rptFacialScore">-</td>
                            <td style="padding: 12px;" id="rptFacialSev">-</td>
                        </tr>
                        <tr style="border-bottom: 1px solid var(--color-border);">
                            <td style="padding: 12px;">‚ùì Cognitive</td>
                            <td style="padding: 12px;" id="rptCogStatus">-</td>
                            <td style="padding: 12px; font-weight: bold;" id="rptCogScore">-</td>
                            <td style="padding: 12px;" id="rptCogSev">-</td>
                        </tr>
                        <tr>
                            <td style="padding: 12px;">üåÄ Coordination</td>
                            <td style="padding: 12px;" id="rptCoordStatus">-</td>
                            <td style="padding: 12px; font-weight: bold;" id="rptCoordScore">-</td>
                            <td style="padding: 12px;" id="rptCoordSev">-</td>
                        </tr>
                    </tbody>
                </table>
                <p style="color: var(--color-text-secondary); font-size: 12px;" id="results-note">Complete all tests to generate a comprehensive assessment report.</p>
            </div>
        </div>

        <!-- REPORT VIEW -->
        <div id="reportView" class="view">
            <div class="card">
                <h2 id="report-title">NeuroCompass-PD Clinical Report</h2>
                <div style="margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--color-border);">
                    <h3 id="report-patient-title">Patient Information</h3>
                    <p id="reportPatientInfo" style="color: var(--color-text-secondary);">No patient data</p>
                </div>
                <div style="margin-top: 24px;">
                    <h3 id="report-summary-title">Assessment Summary</h3>
                    <p id="reportSummary" style="color: var(--color-text-secondary);">Complete all tests for comprehensive summary.</p>
                </div>
                <div style="margin-top: 24px;">
                    <h3 id="report-detailed-title">Detailed Results</h3>
                    <div id="reportDetails" style="color: var(--color-text-secondary);">Results pending...</div>
                </div>
                <button id="pdfBtn" class="btn btn-primary" onclick="downloadPDF()" style="margin-top: 24px; display: none; cursor: pointer;">üì• Download PDF Report</button>
            </div>
        </div>

    </main>

    <script src="languages.js"></script>
    <script src="assessment.js"></script>
</body>
</html>