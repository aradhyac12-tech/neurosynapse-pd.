<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#0f0f23">
    <title>NeuroCompass-PD | Clinical Assessment</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js"></script>
</head>
<body>

<!-- SPLASH SCREEN -->
<div class="splash-screen" id="splashScreen">
    <div class="splash-logo">ğŸ§ </div>
    <h1 class="splash-title">NeuroCompass-PD</h1>
    <p class="splash-subtitle">MDS-UPDRS Clinical Assessment Suite</p>
    <div class="splash-progress-container">
        <div class="splash-progress">
            <div class="splash-progress-bar" id="splashProgress"></div>
        </div>
    </div>
</div>

<!-- NAVBAR -->
<nav class="navbar">
    <button id="hamburgerBtn" class="hamburger-btn">â˜°</button>
    
    <div class="navbar-center">
        <span class="brand-icon">ğŸ§ </span>
        <div class="navbar-brand">
            <div class="brand-name">NeuroCompass-PD</div>
            <div class="brand-version">v4.2 UPDRS</div>
        </div>
    </div>

    <div class="navbar-right">
        <select id="languageSelector" class="language-dropdown">
            <option value="en">ğŸŒ EN</option>
            <option value="hi">ğŸ‡®ğŸ‡³ HI</option>
            <option value="ru">ğŸ‡·ğŸ‡º RU</option>
        </select>
        <button id="voiceBtn" class="voice-btn">ğŸ”Š</button>
    </div>
</nav>

<!-- SIDEBAR -->
<div id="sidebar" class="sidebar">
    <div class="sidebar-header">
        <h2>Navigation</h2>
        <button id="closeSidebarBtn" class="close-btn">âœ•</button>
    </div>
    <nav class="sidebar-nav">
        <a href="#" class="nav-link active" data-view="dashboard">ğŸ“ˆ Dashboard</a>
        <a href="#" class="nav-link" data-view="info">â„¹ï¸ PD Info</a>
        <a href="#" class="nav-link" data-view="patient">ğŸ‘¤ Patient</a>
        <a href="#" class="nav-link" data-view="voice">ğŸ¤ Speech</a>
        <a href="#" class="nav-link" data-view="tremor">ğŸ“³ Tremor</a>
        <a href="#" class="nav-link" data-view="gait">ğŸš¶ Gait</a>
        <a href="#" class="nav-link" data-view="facial">ğŸ˜Š Facial</a>
        <a href="#" class="nav-link" data-view="questions">â“ Questions</a>
        <a href="#" class="nav-link" data-view="spiral">ğŸŒ€ Spiral</a>
        <a href="#" class="nav-link" data-view="results">ğŸ“Š Results</a>
        <a href="#" class="nav-link" data-view="report">ğŸ“„ Report</a>
    </nav>
    <div class="sidebar-footer">
        <p><strong>Created by</strong></p>
        <p>Aradhya Chavan</p>
        <p><strong>Email:</strong></p>
        <p><a href="mailto:aradhyachavan2@gmail.com">aradhyachavan2@gmail.com</a></p>
    </div>
</div>

<div id="sidebarOverlay" class="sidebar-overlay"></div>

<!-- MAIN CONTENT -->
<main class="main-content">

    <!-- DASHBOARD -->
    <div class="view active" id="dashboardView">
        <div class="card">
            <h2>Dashboard</h2>
            <div class="dashboard-grid">
                <div class="dashboard-box">
                    <div class="box-icon">ğŸ‘¤</div>
                    <h3>Patient Profile</h3>
                    <p id="patientStatus">Required</p>
                    <button class="btn btn-primary" onclick="navigateTo('patient')">Complete</button>
                </div>
                <div class="dashboard-box">
                    <div class="box-icon">ğŸ”¬</div>
                    <h3>Screening Tests</h3>
                    <p id="testCount">0/6</p>
                    <button class="btn btn-secondary" id="startTestsBtn" onclick="navigateTo('voice')">Start Tests</button>
                </div>
                <div class="dashboard-box">
                    <div class="box-icon">ğŸ“Š</div>
                    <h3>Report</h3>
                    <p>Results</p>
                    <button class="btn btn-secondary" id="reportBtn" onclick="navigateTo('report')" disabled>View Report</button>
                </div>
            </div>
        </div>
    </div>

    <!-- PD INFO -->
    <div class="view" id="infoView">
        <div class="card">
            <h2>Parkinson's Disease Information</h2>
            <div class="info-box">
                <h3>What is Parkinson's?</h3>
                <p>A progressive neurodegenerative disorder characterized by motor and non-motor symptoms including tremor, bradykinesia, rigidity, and postural instability.</p>
            </div>
            <div class="info-box">
                <h3>MDS-UPDRS Assessment</h3>
                <p>Movement Disorder Society - Unified Parkinson's Disease Rating Scale. Clinical gold standard for comprehensive motor and non-motor examination. Includes speech, tremor, gait, and facial expression assessment.</p>
            </div>
            <button class="btn btn-primary btn-block" onclick="navigateTo('patient')">Continue</button>
        </div>
    </div>

    <!-- PATIENT FORM -->
    <div class="view" id="patientView">
        <div class="card">
            <h2>Patient Information</h2>
            <form id="patientForm" onsubmit="savePatient(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label>First Name</label>
                        <input type="text" id="firstName" required>
                    </div>
                    <div class="form-group">
                        <label>Last Name</label>
                        <input type="text" id="lastName" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Date of Birth</label>
                        <input type="date" id="dob" required onchange="validateAge()">
                        <span id="ageError" style="color: red; display: none;">Must be 18+</span>
                    </div>
                    <div class="form-group">
                        <label>Gender</label>
                        <select id="gender" required>
                            <option value="">Select</option>
                            <option value="M">Male</option>
                            <option value="F">Female</option>
                            <option value="O">Other</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Country Code</label>
                        <select id="countryCode" required>
                            <option value="">Select</option>
                            <option value="+1">ğŸ‡ºğŸ‡¸ +1 USA</option>
                            <option value="+44">ğŸ‡¬ğŸ‡§ +44 UK</option>
                            <option value="+91">ğŸ‡®ğŸ‡³ +91 India</option>
                            <option value="+7">ğŸ‡·ğŸ‡º +7 Russia</option>
                            <option value="+86">ğŸ‡¨ğŸ‡³ +86 China</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Phone</label>
                        <input type="tel" id="phone" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="email" required>
                    </div>
                    <div class="form-group">
                        <label>Medical ID</label>
                        <input type="text" id="medicalId">
                    </div>
                </div>
                <button type="submit" class="btn btn-success btn-block">Save & Unlock Tests</button>
            </form>
        </div>
    </div>

    <!-- VOICE TEST -->
    <div class="view" id="voiceView">
        <div class="card">
            <h2>ğŸ¤ Speech Assessment (MDS-UPDRS Item 3.1)</h2>
            <p>Say "AAAAA" for 6 seconds - Three trials</p>
            
            <div id="voiceCountdown" class="countdown-display" style="display: none;">
                <div>Starting in</div>
                <div class="timer-big" id="voiceCountdownNum">3</div>
            </div>

            <div id="voiceRecording" style="display: none; text-align: center; margin: 2rem 0;">
                <svg class="waveform" viewBox="0 0 100 40">
                    <circle cx="15" cy="20" r="2" class="wave-dot"></circle>
                    <circle cx="25" cy="20" r="2" class="wave-dot"></circle>
                    <circle cx="35" cy="20" r="2" class="wave-dot"></circle>
                    <circle cx="45" cy="20" r="2" class="wave-dot"></circle>
                    <circle cx="55" cy="20" r="2" class="wave-dot"></circle>
                    <circle cx="65" cy="20" r="2" class="wave-dot"></circle>
                    <circle cx="75" cy="20" r="2" class="wave-dot"></circle>
                    <circle cx="85" cy="20" r="2" class="wave-dot"></circle>
                </svg>
                <div class="timer-big" id="voiceRecordingNum">6</div>
            </div>

            <div id="voiceMetrics" style="display: none; margin: 2rem 0;">
                <table class="metrics-table">
                    <tr><td>Jitter (%)</td><td id="jitterVal">â€”</td></tr>
                    <tr><td>Shimmer (dB)</td><td id="shimmerVal">â€”</td></tr>
                    <tr><td>HNR (dB)</td><td id="hnrVal">â€”</td></tr>
                    <tr><td>F0 (Hz)</td><td id="f0Val">â€”</td></tr>
                    <tr><td>UPDRS Score</td><td id="voiceUpdrsVal">â€”</td></tr>
                </table>
            </div>

            <div class="trial-dots" id="voiceTrials">
                <span class="dot" id="trial1">1</span>
                <span class="dot" id="trial2">2</span>
                <span class="dot" id="trial3">3</span>
            </div>

            <div style="margin-top: 2rem; display: flex; gap: 1rem;">
                <button id="voiceStartBtn" class="btn btn-primary" onclick="startVoiceRecording()" style="flex: 1;">ğŸ¤ Start</button>
                <button id="voiceCompleteBtn" class="btn btn-success" onclick="completeVoiceTest()" style="flex: 1; display: none;">âœ“ Complete</button>
                <button class="btn btn-secondary" onclick="navigateTo('dashboard')" style="flex: 1;">Cancel</button>
            </div>
        </div>
    </div>

    <!-- TREMOR TEST -->
    <div class="view" id="tremorView">
        <div class="card">
            <h2>ğŸ“³ Tremor Assessment (MDS-UPDRS Item 3.15-3.17)</h2>
            <p>Record tremor from both hands - 10 seconds each</p>

            <div id="tremorHandSelect" style="text-align: center; margin: 2rem 0;">
                <div style="font-size: 2.5rem; margin-bottom: 2rem;">ğŸ‘ˆ SELECT HAND ğŸ‘‰</div>
                <div style="display: flex; gap: 2rem; justify-content: center;">
                    <button class="btn btn-primary btn-large" onclick="selectTremorHand('left')">ğŸ‘ˆ Left Hand</button>
                    <button class="btn btn-primary btn-large" onclick="selectTremorHand('right')">Right Hand ğŸ‘‰</button>
                </div>
            </div>

            <div id="tremorCountdown" class="countdown-display" style="display: none;">
                <div>Starting in</div>
                <div class="timer-big" id="tremorCountdownNum">3</div>
            </div>

            <div id="tremorRecording" style="display: none; text-align: center; margin: 2rem 0;">
                <div style="font-size: 2rem; margin-bottom: 1rem;" id="handEmoji">ğŸ‘‹</div>
                <svg class="waveform" viewBox="0 0 100 40">
                    <circle cx="15" cy="20" r="2" class="wave-dot"></circle>
                    <circle cx="25" cy="20" r="2" class="wave-dot"></circle>
                    <circle cx="35" cy="20" r="2" class="wave-dot"></circle>
                    <circle cx="45" cy="20" r="2" class="wave-dot"></circle>
                    <circle cx="55" cy="20" r="2" class="wave-dot"></circle>
                    <circle cx="65" cy="20" r="2" class="wave-dot"></circle>
                    <circle cx="75" cy="20" r="2" class="wave-dot"></circle>
                    <circle cx="85" cy="20" r="2" class="wave-dot"></circle>
                </svg>
                <div class="timer-big" id="tremorRecordingNum">10</div>
            </div>

            <div id="tremorMetrics" style="display: none; margin: 2rem 0;">
                <table class="metrics-table">
                    <tr><td>Frequency (Hz)</td><td id="freqVal">â€”</td></tr>
                    <tr><td>Amplitude (m/sÂ²)</td><td id="ampVal">â€”</td></tr>
                    <tr><td>Power (dB)</td><td id="powVal">â€”</td></tr>
                    <tr><td>UPDRS Score</td><td id="tremorUpdrsVal">â€”</td></tr>
                </table>
            </div>

            <div class="trial-dots" id="tremorHands">
                <span class="dot" id="leftHand">L</span>
                <span class="dot" id="rightHand">R</span>
            </div>

            <div style="margin-top: 2rem; display: flex; gap: 1rem;">
                <button id="tremorCompleteBtn" class="btn btn-success" onclick="completeTremorTest()" style="flex: 1; display: none;">âœ“ Complete</button>
                <button class="btn btn-secondary" onclick="navigateTo('dashboard')" style="flex: 1;">Cancel</button>
            </div>
        </div>
    </div>

    <!-- GAIT TEST -->
    <div class="view" id="gaitView">
        <div class="card">
            <h2>ğŸš¶ Gait Assessment (MDS-UPDRS Item 3.10-3.12)</h2>
            <p>Walk naturally for 15 seconds - Full video with skeleton tracking</p>

            <div id="gaitStart" style="text-align: center; margin: 2rem 0;">
                <button class="btn btn-primary btn-large" onclick="startGaitTest()">ğŸ¥ Start Gait Recording</button>
            </div>

            <div id="gaitCountdown" class="countdown-display" style="display: none;">
                <div>Starting in</div>
                <div class="timer-big" id="gaitCountdownNum">3</div>
            </div>

            <div id="gaitCamera" style="display: none; text-align: center;">
                <div style="max-width: 600px; margin: 0 auto;">
                    <video id="gaitVideo" class="camera-video" autoplay playsinline></video>
                    <canvas id="gaitCanvas" class="camera-canvas"></canvas>
                </div>
            </div>

            <div id="gaitMetrics" style="display: none; margin: 2rem 0;">
                <table class="metrics-table">
                    <tr><td>Cadence (steps/min)</td><td id="cadVal">â€”</td></tr>
                    <tr><td>Stride Length (m)</td><td id="strVal">â€”</td></tr>
                    <tr><td>Speed (m/s)</td><td id="spdVal">â€”</td></tr>
                    <tr><td>UPDRS Score</td><td id="gaitUpdrsVal">â€”</td></tr>
                </table>
            </div>

            <div style="margin-top: 2rem; display: flex; gap: 1rem;">
                <button id="gaitCompleteBtn" class="btn btn-success" onclick="completeGaitTest()" style="flex: 1; display: none;">âœ“ Complete</button>
                <button class="btn btn-secondary" onclick="navigateTo('dashboard')" style="flex: 1;">Cancel</button>
            </div>
        </div>
    </div>

    <!-- FACIAL TEST -->
    <div class="view" id="facialView">
        <div class="card">
            <h2>ğŸ˜Š Facial Expression (MDS-UPDRS Item 3.1)</h2>
            <p>Maintain natural expression for 10 seconds - Full video with face mesh</p>

            <div id="facialStart" style="text-align: center; margin: 2rem 0;">
                <button class="btn btn-primary btn-large" onclick="startFacialTest()">ğŸ“± Start Facial Recording</button>
            </div>

            <div id="facialCountdown" class="countdown-display" style="display: none;">
                <div>Starting in</div>
                <div class="timer-big" id="facialCountdownNum">3</div>
            </div>

            <div id="facialCamera" style="display: none; text-align: center;">
                <div style="max-width: 600px; margin: 0 auto;">
                    <video id="facialVideo" class="camera-video" autoplay playsinline></video>
                    <canvas id="facialCanvas" class="camera-canvas"></canvas>
                </div>
            </div>

            <div id="facialMetrics" style="display: none; margin: 2rem 0;">
                <table class="metrics-table">
                    <tr><td>Blink Rate (/min)</td><td id="blkVal">â€”</td></tr>
                    <tr><td>Jaw Opening (cm)</td><td id="jawVal">â€”</td></tr>
                    <tr><td>Mouth Width (cm)</td><td id="mthVal">â€”</td></tr>
                    <tr><td>UPDRS Score</td><td id="facialUpdrsVal">â€”</td></tr>
                </table>
            </div>

            <div style="margin-top: 2rem; display: flex; gap: 1rem;">
                <button id="facialCompleteBtn" class="btn btn-success" onclick="completeFacialTest()" style="flex: 1; display: none;">âœ“ Complete</button>
                <button class="btn btn-secondary" onclick="navigateTo('dashboard')" style="flex: 1;">Cancel</button>
            </div>
        </div>
    </div>

    <!-- QUESTIONS -->
    <div class="view" id="questionsView">
        <div class="card">
            <h2>â“ Clinical Questions (MDS-UPDRS Supplementary)</h2>
            <form id="questionsForm" onsubmit="submitQuestions(event)">
                <div class="question-item">
                    <label>1. Do you experience slowness of movement?</label>
                    <div class="radio-group">
                        <label><input type="radio" name="q1" value="0"> No</label>
                        <label><input type="radio" name="q1" value="1"> Mildly</label>
                        <label><input type="radio" name="q1" value="2"> Moderately</label>
                        <label><input type="radio" name="q1" value="3"> Severely</label>
                    </div>
                </div>
                <div class="question-item">
                    <label>2. Do you experience muscle stiffness or rigidity?</label>
                    <div class="radio-group">
                        <label><input type="radio" name="q2" value="0"> No</label>
                        <label><input type="radio" name="q2" value="1"> Mildly</label>
                        <label><input type="radio" name="q2" value="2"> Moderately</label>
                        <label><input type="radio" name="q2" value="3"> Severely</label>
                    </div>
                </div>
                <div class="question-item">
                    <label>3. Do you experience balance or postural instability issues?</label>
                    <div class="radio-group">
                        <label><input type="radio" name="q3" value="0"> No</label>
                        <label><input type="radio" name="q3" value="1"> Mildly</label>
                        <label><input type="radio" name="q3" value="2"> Moderately</label>
                        <label><input type="radio" name="q3" value="3"> Severely</label>
                    </div>
                </div>
                <div style="display: flex; gap: 1rem;">
                    <button type="submit" class="btn btn-success" style="flex: 1;">âœ“ Complete</button>
                    <button type="button" class="btn btn-secondary" onclick="navigateTo('dashboard')" style="flex: 1;">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- SPIRAL TEST -->
    <div class="view" id="spiralView">
        <div class="card">
            <h2>ğŸŒ€ Spiral Drawing (MDS-UPDRS Item 3.5-3.7)</h2>
            <p>Draw a smooth spiral. Start from center and spiral outward smoothly.</p>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem; align-items: start;">
                <div>
                    <h4>Reference Spiral</h4>
                    <canvas id="refSpiral" width="250" height="250"></canvas>
                </div>
                <div>
                    <h4>Your Drawing (Preview)</h4>
                    <canvas id="spiralCanvas" width="250" height="250"></canvas>
                </div>
            </div>

            <div id="spiralMetrics" style="margin: 2rem 0; display: none;">
                <table class="metrics-table">
                    <tr><td>Tremor Index</td><td id="treIdxVal">â€”</td></tr>
                    <tr><td>Path Length (px)</td><td id="pathVal">â€”</td></tr>
                    <tr><td>Velocity (px/step)</td><td id="velVal">â€”</td></tr>
                    <tr><td>UPDRS Score</td><td id="spiralUpdrsVal">â€”</td></tr>
                </table>
            </div>

            <div style="display: flex; gap: 1rem;">
                <button class="btn btn-secondary" onclick="clearSpiral()" style="flex: 1;">ğŸ—‘ï¸ Clear</button>
                <button id="spiralCompleteBtn" class="btn btn-success" onclick="completeSpiralTest()" style="flex: 1;">âœ“ Complete</button>
                <button class="btn btn-secondary" onclick="navigateTo('dashboard')" style="flex: 1;">Cancel</button>
            </div>
        </div>
    </div>

    <!-- RESULTS -->
    <div class="view" id="resultsView">
        <div class="card">
            <h2>ğŸ“Š Clinical Results</h2>
            <table class="results-table">
                <tr><th>Test</th><th>Status</th><th>Score</th><th>UPDRS</th></tr>
                <tr><td>ğŸ¤ Speech</td><td id="voiceStatus">âŒ</td><td id="voiceScore">â€”</td><td id="voiceUpdrs">â€”</td></tr>
                <tr><td>ğŸ“³ Tremor</td><td id="tremorStatus">âŒ</td><td id="tremorScore">â€”</td><td id="tremorUpdrs">â€”</td></tr>
                <tr><td>ğŸš¶ Gait</td><td id="gaitStatus">âŒ</td><td id="gaitScore">â€”</td><td id="gaitUpdrs">â€”</td></tr>
                <tr><td>ğŸ˜Š Facial</td><td id="facialStatus">âŒ</td><td id="facialScore">â€”</td><td id="facialUpdrs">â€”</td></tr>
                <tr><td>â“ Questions</td><td id="questionsStatus">âŒ</td><td id="questionsScore">â€”</td><td id="questionsUpdrs">â€”</td></tr>
                <tr><td>ğŸŒ€ Spiral</td><td id="spiralStatus">âŒ</td><td id="spiralScore">â€”</td><td id="spiralUpdrs">â€”</td></tr>
                <tr style="font-weight: bold; background: rgba(14, 165, 233, 0.1);"><td>TOTAL UPDRS SCORE</td><td colspan="3" id="totalUpdrs">â€”</td></tr>
            </table>
            <div style="margin-top: 2rem; display: flex; gap: 1rem;">
                <button class="btn btn-primary" onclick="navigateTo('report')" style="flex: 1;">Generate Report</button>
                <button class="btn btn-secondary" onclick="navigateTo('dashboard')" style="flex: 1;">Back</button>
            </div>
        </div>
    </div>

    <!-- REPORT -->
    <div class="view" id="reportView">
        <div class="card">
            <h2>ğŸ“„ Clinical Report - MDS-UPDRS Assessment</h2>
            <div id="reportContent">
                <h3>Patient Information</h3>
                <p id="reportPatientInfo">â€”</p>
                
                <h3>Assessment Summary</h3>
                <canvas id="radarChart" style="max-height: 400px;"></canvas>
                
                <h3>Detailed Results</h3>
                <table class="results-table">
                    <tr><th>Domain</th><th>Score</th><th>Severity</th></tr>
                    <tr><td>Speech</td><td id="rptVoice">â€”</td><td id="rptVoiceSev">â€”</td></tr>
                    <tr><td>Tremor</td><td id="rptTremor">â€”</td><td id="rptTremorSev">â€”</td></tr>
                    <tr><td>Gait</td><td id="rptGait">â€”</td><td id="rptGaitSev">â€”</td></tr>
                    <tr><td>Facial</td><td id="rptFacial">â€”</td><td id="rptFacialSev">â€”</td></tr>
                    <tr><td>Cognitive</td><td id="rptCog">â€”</td><td id="rptCogSev">â€”</td></tr>
                    <tr><td>Coordination</td><td id="rptCoord">â€”</td><td id="rptCoordSev">â€”</td></tr>
                    <tr style="font-weight: bold;"><td>TOTAL MDS-UPDRS</td><td id="rptTotal">â€”</td><td id="rptTotalSev">â€”</td></tr>
                </table>
            </div>
            <div style="margin-top: 2rem; display: flex; gap: 1rem;">
                <button class="btn btn-success" onclick="downloadPDF()" style="flex: 1;">â¬‡ï¸ Download PDF Report</button>
                <button class="btn btn-secondary" onclick="navigateTo('dashboard')" style="flex: 1;">Back</button>
            </div>
        </div>
    </div>

</main>

<script src="lang.js"></script>
<script src="mediapipe_init.js"></script>
<script src="assessment.js"></script>

</body>
</html>