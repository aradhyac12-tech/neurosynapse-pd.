<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clinical Assessment System</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <i class="fas fa-stethoscope"></i>
                <h1>NeuroAssess Pro</h1>
            </div>
            <div class="header-controls">
                <div class="language-selector">
                    <i class="fas fa-globe"></i>
                    <select id="language-select">
                        <option value="en">English</option>
                        <option value="es">Español</option>
                        <option value="fr">Français</option>
                        <option value="de">Deutsch</option>
                        <option value="it">Italiano</option>
                        <option value="pt">Português</option>
                        <option value="zh">中文</option>
                        <option value="ja">日本語</option>
                    </select>
                </div>
                <button class="btn-secondary" onclick="clinicalAssessment.exportResults()">
                    <i class="fas fa-download"></i> Export Results
                </button>
                <button class="btn-secondary" onclick="clearResults()">
                    <i class="fas fa-trash"></i> Clear All
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Sidebar -->
            <nav class="sidebar">
                <div class="user-profile">
                    <div class="avatar">
                        <i class="fas fa-user-md"></i>
                    </div>
                    <div class="profile-info">
                        <h3 id="patient-name">Dr. Jane Smith</h3>
                        <p id="patient-id">ID: NEURO-001</p>
                    </div>
                </div>

                <ul class="nav-menu">
                    <li class="nav-item active" onclick="nav('dashboard')">
                        <i class="fas fa-home"></i>
                        <span data-translate="dashboard">Dashboard</span>
                    </li>
                    <li class="nav-item" onclick="nav('patient-management')">
                        <i class="fas fa-user-injured"></i>
                        <span data-translate="patientManagement">Patient Management</span>
                    </li>
                    <li class="nav-item" onclick="nav('assessments')">
                        <i class="fas fa-clipboard-check"></i>
                        <span data-translate="assessments">Assessments</span>
                    </li>
                    <li class="nav-item" onclick="nav('results')">
                        <i class="fas fa-chart-line"></i>
                        <span data-translate="results">Results & Analytics</span>
                    </li>
                    <li class="nav-item" onclick="nav('settings')">
                        <i class="fas fa-cog"></i>
                        <span data-translate="settings">Settings</span>
                    </li>
                </ul>

                <div class="system-status">
                    <h4 data-translate="systemStatus">System Status</h4>
                    <div class="status-item">
                        <span data-translate="camera">Camera:</span>
                        <span class="status-indicator active" id="camera-status">Ready</span>
                    </div>
                    <div class="status-item">
                        <span data-translate="microphone">Microphone:</span>
                        <span class="status-indicator active" id="mic-status">Ready</span>
                    </div>
                    <div class="status-item">
                        <span data-translate="storage">Storage:</span>
                        <span class="status-indicator active" id="storage-status">1.2 GB Free</span>
                    </div>
                </div>
            </nav>

            <!-- Content Area -->
            <div class="content-area">
                <!-- Dashboard View -->
                <div id="dashboard" class="view active">
                    <div class="view-header">
                        <h2 data-translate="dashboard">Dashboard</h2>
                        <p data-translate="welcomeMessage">Welcome to the Clinical Assessment System</p>
                    </div>

                    <div class="quick-stats">
                        <div class="stat-card">
                            <div class="stat-icon" style="background: #4CAF50;">
                                <i class="fas fa-microphone"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="voice-summary" class="summary">No voice test completed</h3>
                                <p data-translate="voiceAssessment">Voice Assessment</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon" style="background: #2196F3;">
                                <i class="fas fa-hand-paper"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="tremor-summary" class="summary">No tremor test completed</h3>
                                <p data-translate="tremorAssessment">Tremor Assessment</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon" style="background: #FF9800;">
                                <i class="fas fa-walking"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="gait-summary" class="summary">No gait test completed</h3>
                                <p data-translate="gaitAssessment">Gait Assessment</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon" style="background: #9C27B0;">
                                <i class="fas fa-smile"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="face-summary" class="summary">No facial test completed</h3>
                                <p data-translate="facialAssessment">Facial Assessment</p>
                            </div>
                        </div>
                    </div>

                    <div class="recent-activity">
                        <h3 data-translate="recentActivity">Recent Activity</h3>
                        <div class="activity-list">
                            <div class="activity-item">
                                <i class="fas fa-microphone activity-icon"></i>
                                <div class="activity-details">
                                    <p data-translate="voiceTestReady">Voice assessment ready</p>
                                    <small>Just now</small>
                                </div>
                            </div>
                            <div class="activity-item">
                                <i class="fas fa-camera activity-icon"></i>
                                <div class="activity-details">
                                    <p data-translate="cameraCalibrated">Camera calibrated successfully</p>
                                    <small>2 minutes ago</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Patient Management View -->
                <div id="patient-management" class="view">
                    <div class="view-header">
                        <h2 data-translate="patientManagement">Patient Management</h2>
                        <button class="btn-primary" onclick="showPatientModal()">
                            <i class="fas fa-plus"></i> Add New Patient
                        </button>
                    </div>

                    <div class="patient-list">
                        <!-- Patient cards will be populated by JavaScript -->
                        <div class="empty-state">
                            <i class="fas fa-user-injured"></i>
                            <h3 data-translate="noPatients">No Patients Added</h3>
                            <p data-translate="addFirstPatient">Add your first patient to begin assessments</p>
                            <button class="btn-primary" onclick="showPatientModal()">
                                <i class="fas fa-plus"></i> Add Patient
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Assessments View -->
                <div id="assessments" class="view">
                    <div class="view-header">
                        <h2 data-translate="clinicalAssessments">Clinical Assessments</h2>
                        <p data-translate="selectAssessment">Select an assessment to begin</p>
                    </div>

                    <div class="assessment-grid">
                        <!-- Voice Assessment Card -->
                        <div class="assessment-card">
                            <div class="card-header">
                                <div class="card-icon" style="background: #4CAF50;">
                                    <i class="fas fa-microphone"></i>
                                </div>
                                <h3 data-translate="voiceAssessment">Voice Assessment</h3>
                            </div>
                            <p data-translate="voiceDescription">Analyze voice characteristics including volume, pitch, and stability for neurological evaluation.</p>
                            <div class="card-actions">
                                <button class="btn-primary start-test-btn" data-test="voice">
                                    <i class="fas fa-play"></i> <span data-translate="startTest">Start Test</span>
                                </button>
                                <button class="btn-secondary stop-test-btn" data-test="voice" style="display: none;">
                                    <i class="fas fa-stop"></i> <span data-translate="stopTest">Stop Test</span>
                                </button>
                            </div>
                            <div class="test-results" id="voice-results"></div>
                        </div>

                        <!-- Tremor Assessment Card -->
                        <div class="assessment-card">
                            <div class="card-header">
                                <div class="card-icon" style="background: #2196F3;">
                                    <i class="fas fa-hand-paper"></i>
                                </div>
                                <h3 data-translate="tremorAssessment">Tremor Assessment</h3>
                            </div>
                            <p data-translate="tremorDescription">Evaluate hand tremor frequency and amplitude for Parkinson's and essential tremor assessment.</p>
                            <div class="card-actions">
                                <button class="btn-primary start-test-btn" data-test="tremor">
                                    <i class="fas fa-play"></i> <span data-translate="startTest">Start Test</span>
                                </button>
                                <button class="btn-secondary stop-test-btn" data-test="tremor" style="display: none;">
                                    <i class="fas fa-stop"></i> <span data-translate="stopTest">Stop Test</span>
                                </button>
                            </div>
                            <div class="test-results" id="tremor-results"></div>
                        </div>

                        <!-- Gait Assessment Card -->
                        <div class="assessment-card">
                            <div class="card-header">
                                <div class="card-icon" style="background: #FF9800;">
                                    <i class="fas fa-walking"></i>
                                </div>
                                <h3 data-translate="gaitAssessment">Gait Assessment</h3>
                            </div>
                            <p data-translate="gaitDescription">Analyze walking pattern, step count, and balance for mobility and neurological disorder evaluation.</p>
                            <div class="card-actions">
                                <button class="btn-primary start-test-btn" data-test="gait">
                                    <i class="fas fa-play"></i> <span data-translate="startTest">Start Test</span>
                                </button>
                                <button class="btn-secondary stop-test-btn" data-test="gait" style="display: none;">
                                    <i class="fas fa-stop"></i> <span data-translate="stopTest">Stop Test</span>
                                </button>
                            </div>
                            <div class="test-results" id="gait-results"></div>
                        </div>

                        <!-- Facial Assessment Card -->
                        <div class="assessment-card">
                            <div class="card-header">
                                <div class="card-icon" style="background: #9C27B0;">
                                    <i class="fas fa-smile"></i>
                                </div>
                                <h3 data-translate="facialAssessment">Facial Assessment</h3>
                            </div>
                            <p data-translate="facialDescription">Evaluate facial symmetry, blink rate, and muscle movement for facial nerve and neurological assessment.</p>
                            <div class="card-actions">
                                <button class="btn-primary start-test-btn" data-test="face">
                                    <i class="fas fa-play"></i> <span data-translate="startTest">Start Test</span>
                                </button>
                                <button class="btn-secondary stop-test-btn" data-test="face" style="display: none;">
                                    <i class="fas fa-stop"></i> <span data-translate="stopTest">Stop Test</span>
                                </button>
                            </div>
                            <div class="test-results" id="face-results"></div>
                        </div>
                    </div>

                    <!-- Test Views -->
                    <div class="test-views">
                        <!-- Voice Test View -->
                        <div id="voice-test-view" class="test-view">
                            <div class="test-header">
                                <h3><i class="fas fa-microphone"></i> <span data-translate="voiceAssessment">Voice Assessment</span></h3>
                                <button class="btn-secondary stop-test-btn">
                                    <i class="fas fa-stop"></i> <span data-translate="stopTest">Stop Test</span>
                                </button>
                            </div>
                            <div class="test-instructions">
                                <p data-translate="voiceInstructions">Please speak into the microphone. The system will analyze your voice characteristics.</p>
                            </div>
                            <div class="test-visualization">
                                <canvas id="voice-viz" width="800" height="200"></canvas>
                            </div>
                            <div class="test-metrics">
                                <div class="metric">
                                    <h4 data-translate="volume">Volume</h4>
                                    <div class="metric-value" id="v-db">0.00 dB</div>
                                </div>
                                <div class="metric">
                                    <h4 data-translate="pitch">Pitch</h4>
                                    <div class="metric-value" id="v-pitch">0.00 Hz</div>
                                </div>
                                <div class="metric">
                                    <h4 data-translate="stability">Stability</h4>
                                    <div class="metric-value" id="v-stability">0.00%</div>
                                </div>
                            </div>
                        </div>

                        <!-- Tremor Test View -->
                        <div id="tremor-test-view" class="test-view">
                            <div class="test-header">
                                <h3><i class="fas fa-hand-paper"></i> <span data-translate="tremorAssessment">Tremor Assessment</span></h3>
                                <button class="btn-secondary stop-test-btn">
                                    <i class="fas fa-stop"></i> <span data-translate="stopTest">Stop Test</span>
                                </button>
                            </div>
                            <div class="test-instructions">
                                <p data-translate="tremorInstructions">Please hold your hand steady in front of the camera. Keep your palm facing the camera.</p>
                            </div>
                            <div class="test-visualization">
                                <video id="camera-feed" width="640" height="480" autoplay playsinline></video>
                                <canvas id="tremor-canvas" width="640" height="480"></canvas>
                            </div>
                            <div class="test-metrics">
                                <div class="metric">
                                    <h4 data-translate="tremorScore">Tremor Score</h4>
                                    <div class="metric-value" id="t-score">0.0</div>
                                </div>
                                <div class="metric">
                                    <h4 data-translate="amplitude">Amplitude</h4>
                                    <div class="metric-value" id="t-amp">0.00</div>
                                </div>
                                <div class="metric">
                                    <h4 data-translate="frequency">Frequency</h4>
                                    <div class="metric-value" id="t-freq">0.00 Hz</div>
                                </div>
                            </div>
                        </div>

                        <!-- Gait Test View -->
                        <div id="gait-test-view" class="test-view">
                            <div class="test-header">
                                <h3><i class="fas fa-walking"></i> <span data-translate="gaitAssessment">Gait Assessment</span></h3>
                                <button class="btn-secondary stop-test-btn">
                                    <i class="fas fa-stop"></i> <span data-translate="stopTest">Stop Test</span>
                                </button>
                            </div>
                            <div class="test-instructions">
                                <p data-translate="gaitInstructions">Please walk naturally in front of the camera. The system will count your steps and analyze your gait.</p>
                            </div>
                            <div class="test-visualization">
                                <video id="gait-camera-feed" width="640" height="480" autoplay playsinline></video>
                                <canvas id="gait-canvas" width="640" height="480"></canvas>
                            </div>
                            <div class="test-metrics">
                                <div class="metric">
                                    <h4 data-translate="stepCount">Step Count</h4>
                                    <div class="metric-value" id="g-steps">0</div>
                                </div>
                                <div class="metric">
                                    <h4 data-translate="leftFoot">Left Foot</h4>
                                    <div class="metric-value" id="g-left">0.000</div>
                                    <div class="step-indicator" id="g-left-indicator"></div>
                                </div>
                                <div class="metric">
                                    <h4 data-translate="rightFoot">Right Foot</h4>
                                    <div class="metric-value" id="g-right">0.000</div>
                                    <div class="step-indicator" id="g-right-indicator"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Face Test View -->
                        <div id="face-test-view" class="test-view">
                            <div class="test-header">
                                <h3><i class="fas fa-smile"></i> <span data-translate="facialAssessment">Facial Assessment</span></h3>
                                <button class="btn-secondary stop-test-btn">
                                    <i class="fas fa-stop"></i> <span data-translate="stopTest">Stop Test</span>
                                </button>
                            </div>
                            <div class="test-instructions">
                                <p data-translate="faceInstructions">Please face the camera directly. The system will analyze your facial movements and blink rate.</p>
                            </div>
                            <div class="test-visualization">
                                <video id="face-camera-feed" width="640" height="480" autoplay playsinline></video>
                                <canvas id="face-canvas" width="640" height="480"></canvas>
                            </div>
                            <div class="test-metrics">
                                <div class="metric">
                                    <h4 data-translate="leftEye">Left Eye</h4>
                                    <div class="metric-value" id="f-left">0.000</div>
                                    <div class="eye-indicator" id="f-left-eye"></div>
                                </div>
                                <div class="metric">
                                    <h4 data-translate="rightEye">Right Eye</h4>
                                    <div class="metric-value" id="f-right">0.000</div>
                                    <div class="eye-indicator" id="f-right-eye"></div>
                                </div>
                                <div class="metric">
                                    <h4 data-translate="blinkCount">Blinks</h4>
                                    <div class="metric-value" id="f-blink">0</div>
                                </div>
                                <div class="metric">
                                    <h4 data-translate="blinkRate">Blink Rate</h4>
                                    <div class="metric-value" id="f-rate">0.0/min</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Results View -->
                <div id="results" class="view">
                    <div class="view-header">
                        <h2 data-translate="resultsAnalytics">Results & Analytics</h2>
                        <div class="view-controls">
                            <button class="btn-secondary" onclick="clinicalAssessment.exportResults()">
                                <i class="fas fa-download"></i> Export All
                            </button>
                            <button class="btn-secondary" onclick="clearResults()">
                                <i class="fas fa-trash"></i> Clear All
                            </button>
                        </div>
                    </div>

                    <div class="results-container">
                        <div class="results-summary">
                            <h3 data-translate="assessmentSummary">Assessment Summary</h3>
                            <div class="summary-cards">
                                <div class="summary-card">
                                    <h4 data-translate="totalAssessments">Total Assessments</h4>
                                    <div class="summary-value" id="total-assessments">0</div>
                                </div>
                                <div class="summary-card">
                                    <h4 data-translate="lastAssessment">Last Assessment</h4>
                                    <div class="summary-value" id="last-assessment">N/A</div>
                                </div>
                                <div class="summary-card">
                                    <h4 data-translate="averageScore">Average Score</h4>
                                    <div class="summary-value" id="average-score">0.0</div>
                                </div>
                            </div>
                        </div>

                        <div class="detailed-results">
                            <h3 data-translate="detailedResults">Detailed Results</h3>
                            <div class="results-tabs">
                                <button class="results-tab active" onclick="showResultsTab('voice')">
                                    <i class="fas fa-microphone"></i> Voice
                                </button>
                                <button class="results-tab" onclick="showResultsTab('tremor')">
                                    <i class="fas fa-hand-paper"></i> Tremor
                                </button>
                                <button class="results-tab" onclick="showResultsTab('gait')">
                                    <i class="fas fa-walking"></i> Gait
                                </button>
                                <button class="results-tab" onclick="showResultsTab('face')">
                                    <i class="fas fa-smile"></i> Facial
                                </button>
                            </div>

                            <div class="results-content">
                                <div id="voice-results-tab" class="results-tab-content active">
                                    <h4 data-translate="voiceResults">Voice Assessment Results</h4>
                                    <div class="results-table">
                                        <table>
                                            <thead>
                                                <tr>
                                                    <th data-translate="date">Date</th>
                                                    <th data-translate="volume">Volume (dB)</th>
                                                    <th data-translate="pitch">Pitch (Hz)</th>
                                                    <th data-translate="stability">Stability</th>
                                                    <th data-translate="status">Status</th>
                                                </tr>
                                            </thead>
                                            <tbody id="voice-results-table">
                                                <tr>
                                                    <td colspan="5" data-translate="noResults">No results available</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                <div id="tremor-results-tab" class="results-tab-content">
                                    <h4 data-translate="tremorResults">Tremor Assessment Results</h4>
                                    <!-- Similar table structure for tremor results -->
                                </div>

                                <div id="gait-results-tab" class="results-tab-content">
                                    <h4 data-translate="gaitResults">Gait Assessment Results</h4>
                                    <!-- Similar table structure for gait results -->
                                </div>

                                <div id="face-results-tab" class="results-tab-content">
                                    <h4 data-translate="faceResults">Facial Assessment Results</h4>
                                    <!-- Similar table structure for face results -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings View -->
                <div id="settings" class="view">
                    <div class="view-header">
                        <h2 data-translate="settings">Settings</h2>
                    </div>

                    <div class="settings-container">
                        <div class="settings-section">
                            <h3 data-translate="deviceSettings">Device Settings</h3>
                            <div class="setting-item">
                                <label data-translate="cameraDevice">Camera Device</label>
                                <select id="camera-select">
                                    <option value="default" data-translate="defaultCamera">Default Camera</option>
                                </select>
                            </div>
                            <div class="setting-item">
                                <label data-translate="microphoneDevice">Microphone Device</label>
                                <select id="microphone-select">
                                    <option value="default" data-translate="defaultMicrophone">Default Microphone</option>
                                </select>
                            </div>
                        </div>

                        <div class="settings-section">
                            <h3 data-translate="assessmentSettings">Assessment Settings</h3>
                            <div class="setting-item">
                                <label data-translate="testDuration">Test Duration (seconds)</label>
                                <input type="number" id="test-duration" value="30" min="10" max="120">
                            </div>
                            <div class="setting-item">
                                <label>
                                    <input type="checkbox" id="auto-save" checked>
                                    <span data-translate="autoSaveResults">Auto-save results</span>
                                </label>
                            </div>
                        </div>

                        <div class="settings-section">
                            <h3 data-translate="dataManagement">Data Management</h3>
                            <div class="setting-item">
                                <button class="btn-secondary" onclick="clinicalAssessment.exportResults()">
                                    <i class="fas fa-download"></i> <span data-translate="exportAllData">Export All Data</span>
                                </button>
                            </div>
                            <div class="setting-item">
                                <button class="btn-danger" onclick="clearAllData()">
                                    <i class="fas fa-trash"></i> <span data-translate="clearAllData">Clear All Data</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Patient Modal -->
    <div id="patient-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 data-translate="addPatient">Add New Patient</h3>
                <button class="close-modal" onclick="closePatientModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="patient-form">
                    <div class="form-group">
                        <label data-translate="fullName">Full Name</label>
                        <input type="text" id="patient-name-input" required>
                    </div>
                    <div class="form-group">
                        <label data-translate="dateOfBirth">Date of Birth</label>
                        <input type="date" id="patient-dob" required>
                    </div>
                    <div class="form-group">
                        <label data-translate="gender">Gender</label>
                        <select id="patient-gender" required>
                            <option value="male" data-translate="male">Male</option>
                            <option value="female" data-translate="female">Female</option>
                            <option value="other" data-translate="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label data-translate="medicalId">Medical ID</label>
                        <input type="text" id="patient-medical-id" required>
                    </div>
                    <div class="form-group">
                        <label data-translate="notes">Notes</label>
                        <textarea id="patient-notes" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closePatientModal()" data-translate="cancel">Cancel</button>
                <button class="btn-primary" onclick="savePatient()" data-translate="savePatient">Save Patient</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/holistic/holistic.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
    <script src="assessment.js"></script>
    
    <!-- Navigation and Utility Functions -->
    <script>
        // Navigation function
        function nav(viewId) {
            // Hide all views
            document.querySelectorAll('.view').forEach(view => {
                view.classList.remove('active');
            });
            
            // Show selected view
            const selectedView = document.getElementById(viewId);
            if (selectedView) {
                selectedView.classList.add('active');
            }
            
            // Update active nav item
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Find and activate corresponding nav item
            const navItem = document.querySelector(`.nav-item[onclick*="${viewId}"]`);
            if (navItem) {
                navItem.classList.add('active');
            }
            
            // If switching away from assessments, stop any running test
            if (viewId !== 'assessments' && window.clinicalAssessment && window.clinicalAssessment.state.isTesting) {
                window.clinicalAssessment.stopTest();
            }
        }

        // Patient modal functions
        function showPatientModal() {
            document.getElementById('patient-modal').style.display = 'block';
        }

        function closePatientModal() {
            document.getElementById('patient-modal').style.display = 'none';
            document.getElementById('patient-form').reset();
        }

        function savePatient() {
            const name = document.getElementById('patient-name-input').value;
            const dob = document.getElementById('patient-dob').value;
            const gender = document.getElementById('patient-gender').value;
            const medicalId = document.getElementById('patient-medical-id').value;
            const notes = document.getElementById('patient-notes').value;
            
            if (!name || !dob || !gender || !medicalId) {
                alert('Please fill in all required fields');
                return;
            }
            
            // Generate a unique ID
            const patientId = 'PAT-' + Date.now();
            
            const patient = {
                id: patientId,
                name: name,
                dob: dob,
                gender: gender,
                medicalId: medicalId,
                notes: notes,
                createdAt: new Date().toISOString()
            };
            
            // Save to localStorage
            let patients = JSON.parse(localStorage.getItem('patients') || '[]');
            patients.push(patient);
            localStorage.setItem('patients', JSON.stringify(patients));
            
            // Set as current patient
            localStorage.setItem('currentPatient', JSON.stringify(patient));
            
            // Update UI
            document.getElementById('patient-name').textContent = `Dr. ${name}`;
            document.getElementById('patient-id').textContent = `ID: ${medicalId}`;
            
            // Close modal
            closePatientModal();
            
            // Show success message
            if (window.clinicalAssessment) {
                window.clinicalAssessment.showNotification('Patient saved successfully', 'success');
            }
            
            // Refresh patient list
            loadPatients();
        }

        function loadPatients() {
            const patients = JSON.parse(localStorage.getItem('patients') || '[]');
            const patientList = document.querySelector('.patient-list');
            
            if (patients.length === 0) {
                patientList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-user-injured"></i>
                        <h3 data-translate="noPatients">No Patients Added</h3>
                        <p data-translate="addFirstPatient">Add your first patient to begin assessments</p>
                        <button class="btn-primary" onclick="showPatientModal()">
                            <i class="fas fa-plus"></i> <span data-translate="addPatient">Add Patient</span>
                        </button>
                    </div>
                `;
                return;
            }
            
            let html = '<div class="patient-grid">';
            patients.forEach(patient => {
                html += `
                    <div class="patient-card" onclick="selectPatient('${patient.id}')">
                        <div class="patient-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="patient-info">
                            <h4>${patient.name}</h4>
                            <p>ID: ${patient.medicalId}</p>
                            <small>${patient.dob} • ${patient.gender}</small>
                        </div>
                        <div class="patient-actions">
                            <button class="btn-icon" onclick="event.stopPropagation(); editPatient('${patient.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            
            patientList.innerHTML = html;
        }

        function selectPatient(patientId) {
            const patients = JSON.parse(localStorage.getItem('patients') || '[]');
            const patient = patients.find(p => p.id === patientId);
            
            if (patient) {
                localStorage.setItem('currentPatient', JSON.stringify(patient));
                document.getElementById('patient-name').textContent = `Dr. ${patient.name}`;
                document.getElementById('patient-id').textContent = `ID: ${patient.medicalId}`;
                
                if (window.clinicalAssessment) {
                    window.clinicalAssessment.state.patientProfile = patient;
                    window.clinicalAssessment.showNotification(`Patient ${patient.name} selected`, 'success');
                }
            }
        }

        function editPatient(patientId) {
            // Implementation for editing patient
            console.log('Edit patient:', patientId);
        }

        function showResultsTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.results-tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Deactivate all tabs
            document.querySelectorAll('.results-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            const selectedTab = document.getElementById(`${tabName}-results-tab`);
            const selectedTabButton = document.querySelector(`.results-tab[onclick*="${tabName}"]`);
            
            if (selectedTab) selectedTab.classList.add('active');
            if (selectedTabButton) selectedTabButton.classList.add('active');
        }

        function clearResults() {
            if (confirm('Are you sure you want to clear all results? This action cannot be undone.')) {
                if (window.clinicalAssessment) {
                    window.clinicalAssessment.clearResults();
                }
            }
        }

        function clearAllData() {
            if (confirm('Are you sure you want to clear ALL data including patients and results? This action cannot be undone.')) {
                localStorage.clear();
                if (window.clinicalAssessment) {
                    window.clinicalAssessment.state.patientProfile = null;
                    window.clinicalAssessment.state.assessmentResults = {};
                    window.clinicalAssessment.showNotification('All data cleared', 'success');
                }
                loadPatients();
                location.reload();
            }
        }

        // Load patients on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadPatients();
            
            // Load current patient if exists
            const currentPatient = JSON.parse(localStorage.getItem('currentPatient') || 'null');
            if (currentPatient) {
                document.getElementById('patient-name').textContent = `Dr. ${currentPatient.name}`;
                document.getElementById('patient-id').textContent = `ID: ${currentPatient.medicalId}`;
            }
            
            // Update translations for elements without data-translate attribute
            if (window.clinicalAssessment) {
                window.clinicalAssessment.updateLanguageUI();
            }
        });

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('patient-modal');
            if (event.target === modal) {
                closePatientModal();
            }
        };
    </script>
</body>
</html>